<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Scheduler</title>
  <link rel="stylesheet" href="index.css" />
  <style>
  </style>
</head>
<body>
<header class="header-bar">
  <div class="rank-display">
    <span class="rank-label">Sche</span><span class="rank-title">Duler</span>
  </div>
</header>

<div class="menu-wrapper">
  <button id="categoryBtn" class="hamburger-icon">&#9776;</button>
</div>

<div id="categoryDrawer" class="category-drawer">
  <button class="category-close" id="closeCategory">&times;</button>

  <center><h3>User Menu</h3></center>
  <ul class="user-menu-list">
    <!-- Login (visible when logged out) -->
    <li id="menuLogin-wrapper">
      <button id="menuLogin" style="background:none; border:none; color:var(--neon-gold); font-size:1rem; padding:0; cursor:pointer; display:block; width:100%; text-align:left;">
        Login
      </button>
    </li>

    <!-- Profile (visible when logged in) -->
    <li id="menuProfile" style="display:none;">
      <a href="profile.html">Profile</a>
    </li>

    <!-- Logout (visible when logged in) -->
    <li id="menuLogout" style="display:none;">Logout</li>

    <!-- How to Use -->
    <li><a href="use.html">How to Use</a></li>

    <!-- About -->
    <li><a href="#about-section">About</a></li>

    <!-- Privacy Policy -->
    <li><a href="privacy.html">Privacy Policy</a></li>
  </ul>
</div>

<div id="overlay" class="overlay"></div>
    <main id="mainContent">
  <section class="info-section">
    <h2 id="iot-heading" style="color:#00ffcc;">Welcome to <b style="color:#0ff;">ScheDuler IoT Control</b></h2>
    <p class="tagline" style="color:#ccc;">Your <b style="color:#0ff;">secure</b>, <b style="color:#0ff;">centralized</b> platform for managing connected devices.</p><br>
   <center><p class="tagline" style="color:red;">(Do not Enter<b style="color:#0ff;"> Real Info</b> <b style="color:#0ff;">as it's a</b> demo project.)</p></center>
  </section>

  <section class="info-card-container login-callout-section">
    <div style="text-align:center; padding: 20px 0;">
      <button id="mainLoginBtn" class="load-more" style="width: 90%; max-width: 300px;">
        Start Controlling Your Devices (Login)
      </button>
    </div>
  </section>
  
  <section class="info-card-container">
    <div class="info-card">
      <h3 style="color:#00ffcc;">üí° What is IoT?</h3>
      <p>
        The <b style="color:#0ff;">Internet of Things (IoT)</b> connects physical devices ‚Äî sensors, switches, and machines ‚Äî to the internet.  
        It allows them to collect, send, and act on data without human intervention.  
        This makes systems more <b style="color:#0ff;">efficient, responsive,</b> and <b style="color:#0ff;">automated</b>.  
        ScheDuler IoT bridges that gap, letting you control your devices directly from your browser.
      </p>
    </div>

    <div class="info-card">
      <h3 style="color:#00ffcc;">‚öôÔ∏è Key Functions</h3>
      <ul style="list-style-type:'üöÄ '; margin-left:1em;">
        <li><b style="color:#0ff;">Real-Time Monitoring:</b> Instantly view live device data and status updates.</li>
        <li><b style="color:#0ff;">Remote Control:</b> Turn devices <b>on/off</b>, adjust configurations, and schedule actions from anywhere.</li>
        <li><b style="color:#0ff;">Security:</b> Data and sessions are protected with <b>token-based authentication</b> and encryption.</li>
        <li><b style="color:#0ff;">Profile Management:</b> Organize device groups, automate routines, and track performance easily.</li>
        <li><b style="color:#0ff;">Recovery System:</b> Built-in <b>password reset</b> ensures account access is always recoverable.</li>
        <li><b style="color:#0ff;">Free & Open:</b> User get Free device connection and switches to add.</li>
      </ul>
    </div>

    <div class="info-card" id="about-section">
      <h3 style="color:#00ffcc;">üìò About This Project</h3>
      <p>
        <b style="color:#0ff;">ScheDuler</b> (ScheDuler IoT Control) is a lightweight webapp combining  
        <b style="color:#0ff;">Cloudflare Pages(future is Workers)</b> with <b style="color:#0ff;">ESP-based IoT devices</b> for real-time control and automation.  
        Designed for simplicity, it offers <b style="color:#0ff;">secure login, instant device control,</b> and <b style="color:#0ff;">live feedback</b> ‚Äî  
        all from one centralized dashboard.
      </p>
      <p style="margin-top: 15px; color: #aaa; font-size: 0.9em;">
        <b style="color:#0ff;">How to use:</b> Login to access your personal dashboard.  
        Securely add, monitor, and control your smart devices in seconds.
      </p>
    </div>
  </section>
</main>
  <footer class="footer">
    <p><a href="#about-section" style="color:#fbbf24; margin-right:10px;">About</a> | <a href="#" style="color:#fbbf24;">Some List</a></p>
    <p>&copy; 2025 Scheduler</p>
  </footer>

  <div id="loginModal" class="modal">
    <div class="modal-card">
       <h2 id="closeLoginModal" style="position: absolute; top: -20px; right: -25px; font-size: 1.8rem; cursor: pointer;"></h2>

      <form id="loginForm">
        <input type="email" id="email" placeholder="Email" required />
        <input type="password" id="password" required placeholder="Password" />
        <button type="submit">Login</button>
      </form>
      <p style="text-align:center;margin-top:8px;">
        <a href="forgot-password.html" style="color:#4af;">Forgot password?</a>
      </p>
      <p style="text-align:center;margin-top:6px;">Don‚Äôt have an account? <a href="signup.html" style="color:#4af;">Sign up</a></p>
    </div>
  </div>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const categoryBtn = document.getElementById("categoryBtn");
  const categoryDrawer = document.getElementById("categoryDrawer");
  const closeCategory = document.getElementById("closeCategory");
  const overlay = document.getElementById("overlay");
  const mainContent = document.getElementById("mainContent");

  const menuLogin = document.getElementById("menuLogin"); 
  const mainLoginBtn = document.getElementById("mainLoginBtn"); 
  const menuLogout = document.getElementById("menuLogout");
  const menuProfile = document.getElementById("menuProfile");
  const loginModal = document.getElementById("loginModal");
  const closeLoginModal = document.getElementById("closeLoginModal");
  const loginForm = document.getElementById("loginForm");

  // --- Drawer Toggle Functions ---
  function openDrawer() {
    categoryDrawer.classList.add("open");
    overlay.classList.add("show");
  }
  function closeDrawer() {
    categoryDrawer.classList.remove("open");
    overlay.classList.remove("show");
  }

  categoryBtn.addEventListener("click", openDrawer);
  closeCategory.addEventListener("click", closeDrawer);
  overlay.addEventListener("click", closeDrawer);

  // --- Auth Functions ---
  function updateHeader() {
    const token = localStorage.getItem("token");
    if (token) {
      menuLogin.style.display = "none";
      menuProfile.style.display = "block";
      menuLogout.style.display = "block";
      if (mainLoginBtn) mainLoginBtn.style.display = "none"; 
    } else {
      menuLogin.style.display = "block";
      menuProfile.style.display = "none";
      menuLogout.style.display = "none";
      if (mainLoginBtn) mainLoginBtn.style.display = "block"; 
    }
  }
  updateHeader();

  // --- LOGIN MODAL ---
  const openLoginModal = () => {
    closeDrawer();
    loginModal.style.display = "flex";
  };
  if (menuLogin) menuLogin.addEventListener("click", openLoginModal);
  if (mainLoginBtn) mainLoginBtn.addEventListener("click", openLoginModal); 
  closeLoginModal.addEventListener("click", () => (loginModal.style.display = "none"));
  loginModal.addEventListener("click", (e) => { if (e.target === loginModal) loginModal.style.display = "none"; });

  // --- LOGOUT ---
  menuLogout.addEventListener("click", () => {
    localStorage.removeItem("token");
    updateHeader();
    closeDrawer();
  });

  // --- LOGIN FORM SUBMIT ---
  loginForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value.trim();

    try {
      const res = await fetch("/api/auth", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ action: "login", email, password }),
      });
      const data = await res.json();
      if (!res.ok) return alert(data.error || "Login failed");

      // Store JWT token
      localStorage.setItem("token", data.token);
      loginModal.style.display = "none";
      window.location.href = "profile.html";
    } catch {
      alert("Network error.");
    }
  });
});
</script>
</body>
</html>
